<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Central de Operações - Monitoramento</title>
  
  <!-- FontAwesome para ícones -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <style>
    /* Reset básico */
    * {
      box-sizing: border-box;
    }

    body {
      background: #121722;
      color: #E0E6F1;
      font-family: 'Roboto', 'Segoe UI', Tahoma, sans-serif;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }

    h1 {
      text-align: center;
      font-weight: 700;
      font-size: 2.8rem;
      margin-bottom: 40px;
      letter-spacing: 1.5px;
      text-shadow: 0 0 8px #17a2b8;
    }

    form {
      background: #1e2736;
      padding: 30px 35px;
      border-radius: 12px;
      max-width: 700px;
      margin: 0 auto 50px;
      box-shadow: 0 0 25px rgba(23, 162, 184, 0.5);
      transition: box-shadow 0.3s ease;
    }
    form:hover {
      box-shadow: 0 0 40px rgba(23, 162, 184, 0.8);
    }

    label {
      display: block;
      margin-top: 18px;
      font-weight: 600;
      font-size: 1.1rem;
      color: #b0c4de;
      user-select: none;
    }

    input, select {
      width: 100%;
      padding: 14px 16px;
      border-radius: 10px;
      border: none;
      background: #2a3649;
      color: #E0E6F1;
      font-size: 1.05rem;
      margin-top: 8px;
      transition: background 0.3s ease;
    }
    input::placeholder {
      color: #7a8aa4;
      font-style: italic;
    }
    input:focus, select:focus {
      outline: none;
      background: #374960;
      box-shadow: 0 0 8px #17a2b8;
    }

    button[type="submit"] {
      background: #17a2b8;
      border: none;
      padding: 16px 28px;
      border-radius: 10px;
      color: white;
      font-weight: 700;
      font-size: 1.3rem;
      cursor: pointer;
      margin-top: 30px;
      width: 100%;
      box-shadow: 0 4px 14px rgba(23, 162, 184, 0.7);
      transition: background 0.3s ease;
    }
    button[type="submit"]:hover {
      background: #138496;
      box-shadow: 0 6px 20px rgba(19, 132, 150, 0.9);
    }

    #protocolos {
      max-width: 900px;
      margin: 0 auto;
    }

    #protocolos h2 {
      text-align: center;
      font-weight: 700;
      font-size: 2rem;
      margin-bottom: 20px;
      color: #17a2b8;
      text-shadow: 0 0 8px #17a2b8;
    }

    #search {
      width: 100%;
      padding: 14px 20px;
      margin-bottom: 20px;
      border-radius: 25px;
      border: none;
      background: #2a3649;
      color: #e0e6f1;
      font-size: 1.1rem;
      box-shadow: 0 0 12px rgba(23, 162, 184, 0.5);
      transition: background 0.3s ease;
    }
    #search::placeholder {
      color: #7a8aa4;
      font-style: italic;
    }
    #search:focus {
      outline: none;
      background: #374960;
      box-shadow: 0 0 14px #17a2b8;
    }

    #protocolos button {
      background: #17a2b8;
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      margin-right: 15px;
      box-shadow: 0 3px 10px rgba(23, 162, 184, 0.6);
      transition: background 0.3s ease;
    }
    #protocolos button:hover {
      background: #138496;
      box-shadow: 0 5px 15px rgba(19, 132, 150, 0.8);
    }

    .protocolo {
      background: #1e2736;
      border-left: 8px solid #28a745;
      padding: 22px 28px;
      margin-bottom: 18px;
      border-radius: 16px;
      box-shadow: 0 0 14px rgba(40, 167, 69, 0.5);
      position: relative;
      font-size: 1.1rem;
      line-height: 1.6;
      white-space: pre-line;
      transition: box-shadow 0.3s ease, border-color 0.3s ease;
    }

    /* Status color classes */
    .protocolo.com-alteracao {
      border-left-color: #ffc107; /* amarelo */
      box-shadow: 0 0 18px rgba(255, 193, 7, 0.6);
    }

    .protocolo.sem-alteracao {
      border-left-color: #28a745; /* verde */
      box-shadow: 0 0 14px rgba(40, 167, 69, 0.5);
    }

    /* Botões dentro do protocolo */
    .protocolo button {
      position: absolute;
      top: 18px;
      border-radius: 8px;
      padding: 8px 14px;
      font-size: 1rem;
      cursor: pointer;
      color: white;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 3px 12px rgba(0,0,0,0.2);
      transition: background 0.3s ease;
    }

    .protocolo button.excluir {
      right: 15px;
      background-color: #dc3545;
    }
    .protocolo button.excluir:hover {
      background-color: #b02a37;
    }

    .protocolo button.whatsapp {
      right: 95px;
      background-color: #25D366;
    }
    .protocolo button.whatsapp:hover {
      background-color: #1ebe57;
    }

    /* Ícones no botão */
    .protocolo button i {
      font-size: 1.2rem;
    }

    /* Destaque na busca */
    .highlight {
      background-color: #444f6b;
      transition: background-color 0.3s ease;
    }

    /* Responsivo */
    @media(max-width: 720px) {
      form, #protocolos {
        padding: 15px;
        max-width: 100%;
      }
      .protocolo button.whatsapp {
        right: 70px;
        padding: 8px 12px;
      }
      .protocolo button.excluir {
        right: 10px;
        padding: 8px 12px;
      }
    }
  </style>
</head>
<body>
<img src="image.png" alt="Grupo Claudino" style="display:block;margin:20px auto;max-width:250px;">
  <h1>Central de Operações - Monitoramento</h1>
  <form id="form">
    <label for="lojaBusca">Local Monitorado:</label>
    <input type="text" id="lojaBusca" list="lojas" placeholder="Digite para buscar..." required autocomplete="off" />
    <datalist id="lojas">
  
<option value="	CDM-CODÓ MERCADO CENTRAL	"></option> 
<option value="	TIN-TIMBIRAS	"></option> 
<option value="	CTZ-COROATÁ TRIZIDELA	"></option> 
<option value="	UBS-URBANO SANTOS	"></option> 
<option value="	HBC-HUMBERTO DE CAMPOS	"></option> 
<option value="	SMR-SANTO AMARO DO MARANHÃO	"></option> 
<option value="	TUT-TUTÓIA	"></option> 
<option value="	CNB-CANA BRAVA	"></option> 
<option value="	PLN-PAULINO NEVES	"></option> 
<option value="	VAG-VARGEM GRANDE	"></option> 
<option value="	PLT-PALESTINA	"></option> 
<option value="	ROS-ROSÁRIO	"></option> 
<option value="	ICT-ICATU	"></option> 
<option value="	SRI-SANTA RITA	"></option> 
<option value="	ALA-ALDEIAS ALTAS	"></option> 
<option value="	MTS-MATÕES	"></option> 
<option value="	SJE-SÃO JOÃO DO SOTER	"></option> 
<option value="	LCU-CONCEIÇÃO DO LAGO AÇU	"></option> 
<option value="	PIP-PIRAPEMAS	"></option> 
<option value="	SAM-SÃO MATEUS DO MARANHÃO	"></option> 
<option value="	SLG-SÃO LUÍS GONZAGA DO MARANHÃO	"></option> 
<option value="	SLZ-SANTA LUZIA DO TIDE	"></option> 
<option value="	MON-MONÇÃO	"></option> 
<option value="	BCU-BURITICUPU	"></option> 
<option value="	MAS-MARACAÇUMÉ	"></option> 
<option value="	AGN-ARAGUANÃ	"></option> 
<option value="	CTP-CARUTAPERA	"></option> 
<option value="	GDV-GODOFREDO VIANA	"></option> 
<option value="	SPB-SÃO PEDRO DA ÁGUA BRANCA	"></option> 
<option value="	SFB-SÃO FRANCISCO DO BREJAO	"></option> 
<option value="	ART-ARAGUATÍNS	"></option> 
<option value="	STN-SITIO NOVO DO TOCANTINS	"></option> 
<option value="	PNE-PRAIA NORTE	"></option> 
<option value="	SPT-SAMPAIO	"></option> 
<option value="	COA-CONCEIÇÃO DO ARAUGUAIA	"></option> 
<option value="	ABR-ÁGUA BRANCA	"></option> 
<option value="	AMA-AMARANTE	"></option> 
<option value="	ANG-ANGICAL DO PIAUI	"></option> 
<option value="	BDR-BARRO DURO	"></option> 
<option value="	DLB-DEMERVAL LOBÃO	"></option> 
<option value="	MGL-MONSENHOR GIL	"></option> 
<option value="	PAL-PALMEIRAIS	"></option> 
<option value="	REG-REGENERAÇÃO	"></option> 
<option value="	AGR-AGRICOLÂNDIA	"></option> 
<option value="	SPE-SÃO PEDRO DO PIAUÍ	"></option> 
<option value="	ALS-ALTOS	"></option> 
<option value="	ALG-ALTO LONGÁ	"></option> 
<option value="	BNT-BENEDITINOS	"></option> 
<option value="	NSA-NOVO SANTO ANTONIO	"></option> 
<option value="	OEI-OEIRAS	"></option> 
<option value="	EVL-ELESBÃO VELOSO	"></option> 
<option value="	SCP-SANTA CRUZ DO PIAUI	"></option> 
<option value="	SJP-SÃO JOÃO DO PIAUÍ	"></option> 
<option value="	VAL-VALENÇA DO PIAUI	"></option> 
<option value="	WAF-WALL FERRAZ	"></option> 
<option value="	CAM-CAMPO MAIOR	"></option> 
<option value="	CAD-CAMPO MAIOR DEPOSITO	"></option> 
<option value="	CST-CASTELO DO PAIUI	"></option> 
<option value="	JFT-JOSÉ DE FREITAS	"></option> 
<option value="	MIA-MIGUEL ALVES	"></option> 
<option value="	SMT-SÃO MIGUEL DO TAPUIO	"></option> 
<option value="	UNI-UNIÃO	"></option> 
<option value="	LAL-LAGOA ALEGRE	"></option> 
<option value="	BHO-BOA HORA	"></option> 
<option value="	ARA-ARAIOSES	"></option> 
<option value="	CHV-CHAVAL	"></option> 
<option value="	CIM-CAMOCIM	"></option> 
<option value="	COC-COCAL	"></option> 
<option value="	JPR-JOAQUIM PIRES	"></option> 
<option value="	LCO-LUIS CORREIA	"></option> 
<option value="	PPM-PARNAÍBA PINHEIRO MACHADO	"></option> 
<option value="	PIR-PIRIPIRI	"></option> 
<option value="	PID-PIRIPIRI DEPOSITO	"></option> 
<option value="	BAR-BARRAS	"></option> 
<option value="	ESP-ESPERANTINA	"></option> 
<option value="	MIO-MATIAS OLIMPIO	"></option> 
<option value="	PRT-PORTO	"></option> 
<option value="	SBT-SÃO BENEDITO	"></option> 
<option value="	TIA-TIANGUÁ	"></option> 
<option value="	CCA-CAPITÃO DE CAMPOS	"></option> 
<option value="	NSR-NOSSA SENHORA DOS REMÉDIOS	"></option> 
<option value="	SFR-SÃO FRANCISCO DO MA	"></option> 
<option value="	SJS-SÃO JOÃO DA SERRA	"></option> 
<option value="	CBP-CARAÚBAS	"></option> 
<option value="	DAV-DIRCEU ARCOVERDE	"></option> 
<option value="	RGO-RIBEIRO GONÇALVES	"></option> 
<option value="	FLD-DEPOSITO DE FLORIANO 	"></option> 
<option value="	TRI-TRINDADE	"></option> 
<option value="	OUR-OURICURI	"></option> 
<option value="	PIM-PICOS MÓVEIS	"></option> 
<option value="	CUR-CURIMATÁ	"></option> 
<option value="	COM-COLINAS	"></option> 
<option value="	PNO-PARAIBANO	"></option> 
<option value="	SNM-SITIO NOVO DO MARANHÃO	"></option> 
<option value="	SAD-SÃO DOMINGOS DO MARANHAO	"></option> 
<option value="	DPE-DOM PEDRO	"></option> 
<option value="	GDI-GONÇALVES DIAS	"></option> 
<option value="	ENO-ESPERANTINÓPOLIS	"></option> 
<option value="	IGE-IGARAPÉ GRANDE	"></option> 
<option value="	PER-PERITORÓ	"></option> 
<option value="	PPE-POÇÃO DE PEDRAS	"></option> 
<option value="	TES-TERESINA SHOPPING	"></option> 
<option value="	TPI-TERESINA PIÇARREIRA	"></option> 
<option value="	TPP-TERESINA PARQUE PIAUI	"></option> 
<option value="	TSJ-TERESINA SÃO JOAQUIM	"></option> 
<option value="	TIM-TIMON MOVEIS	"></option> 
<option value="	WAD-WANDERLANDIA	"></option> 
<option value="	VLD-VILA IDELMAR	"></option> 
<option value="	JUP-JUAZEIRO DO PIAUÍ	"></option> 
<option value="	BOP-BOQUEIRÃO DO PIAUÍ	"></option> 
<option value="	MPO-MURUCI DOS PORTELAS	"></option> 
<option value="	LUZ-LUZILÂNDIA	"></option> 
<option value="	PCA-PARNAIBA CARAMURÚ	"></option> 
<option value="	SGP-SIGEFREDO PACHECO	"></option> 
<option value="	BLO-BURITÍ DOS LOPES	"></option> 
<option value="	ARO-AROAZES	"></option> 
<option value="	SAG-SÃO GONÇALO DO PIAUÍ	"></option> 
<option value="	VIC-VIÇOSA DO CEARÁ	"></option> 
<option value="	BAT-BATALHA	"></option> 
<option value="	SRN-SÃO RAIMUNDO NONATO	"></option> 
<option value="	XAB-XAMBIOÁ	"></option> 
<option value="	RDP-REDENÇÃO DO PARA	"></option> 
<option value="	PMA-PADRE MARCOS	"></option> 
<option value="	INH-INHUMA	"></option> 
<option value="	AGD-AGUA DOCE DO MARANHÃO	"></option> 
<option value="	PIC-PICOS	"></option> 
<option value="	PAR-PARNAÍBA	"></option> 
<option value="	COR-CORRENTE	"></option> 
<option value="	ACA-AÇAILÂNDIA	"></option> 
<option value="	BAC-BACABAL	"></option> 
<option value="	CAX-CAXIAS	"></option> 
<option value="	CDP-CAXIAS DEP FECHADO	"></option> 
<option value="	CDP-COD CODÓ	"></option> 
<option value="	ZED-ZÉ DOCA	"></option> 
<option value="	LAB-LAGOA DO BARRO	"></option> 
<option value="	SIN-SANTA INÊS	"></option> 
<option value="	DSI-DEPOSITO DE SANTA INES	"></option> 
<option value="	CAV-COCAL DOS ALVES	"></option> 
<option value="	SRO-SERROLANDIA	"></option> 
<option value="	PED-PEDREIRAS	"></option> 
<option value="	PDU-PRESIDENTE DUTRA	"></option> 
<option value="	DPU-DEPOSITO PRESIDENTE DUTRA	"></option> 
<option value="	TUN-TUNTUM	"></option> 
<option value="	CPP-CAMPINAS DO PIAUI 	"></option> 
<option value="	PIN-PINHEIRO	"></option> 
<option value="	CTA-COROATÁ	"></option> 
<option value="	IDC-IMPERATRIZ DEPOSITO	"></option> 
<option value="	HUN-HUGO NAPOLEAO	"></option> 
<option value="	RGR-REDENÇÃO DO GURGUÉIA	"></option> 
<option value="	PEN-PENALVA	"></option> 
<option value="	MNA-TERESINA	"></option> 
<option value="	CDE-CORRENTE DEPOSITO	"></option> 
<option value="	VLB-VILA LOBÃO	"></option> 
<option value="	WAN-WANDERLEY	"></option> 
<option value="	PIO-PIO XII	"></option> 
<option value="	CGT-CHEGA TUDO	"></option> 
<option value="	AFC-AFONSO CUNHA	"></option> 
<option value="	SFM-SANTA FILOMENA DO MARANHÃO	"></option> 
<option value="	SJV-SÃO JOAO DA VARJOTA	"></option> 
<option value="	BVI-BELA VISTA DO MARANHÃO	"></option> 
<option value="	JUA-JUAZEIRO	"></option> 
<option value="	SCV-SANTA CRUZ DA VENERADA	"></option> 
<option value="	SMP-SIMPLICIO MENDES	"></option> 
<option value="	NIQ-NOVA IORQUE	"></option> 
<option value="	BBS-BAIRRO BOM SUCESSO	"></option> 
<option value="	IMP-IMPERATRIZ	"></option> 
<option value="	CXE-CAXIAS ELETRO	"></option> 
<option value="	XIN-XINGUARA	"></option> 
<option value="	AMM-AMARANTES DO MARANHAO	"></option> 
<option value="	DAB-DEPOSITO AGUA BRANCA	"></option> 
<option value="	PJM-PETROLINA JOSÉ E MARIA	"></option> 
<option value="	CHA-CHAPADINHA	"></option> 
<option value="	ALE-ALTO ALEGRE DO MARANHAO	"></option> 
<option value="	MIR-MIRANDA DO NORTE	"></option> 
<option value="	TMO-TERESINA MOCAMBINHO	"></option> 
<option value="	BHA-BARREIRINHAS	"></option> 
<option value="	TEC-TIMON ELETRO E CONFECÇÕES	"></option> 
<option value="	SPA-SÃO JOÃO DOS PATOS	"></option> 
<option value="	PII-PEDRO II	"></option> 
<option value="	AXA-AXIXÁ	"></option> 
<option value="	ATP-ALTO PARNAÍBA	"></option> 
<option value="	LUCAIA-TERESINA	"></option> 
<option value="	PDM-PRESIDENTE MEDICE	"></option> 
<option value="	CRB-CARNAUBEIRAS	"></option> 
<option value="	MRO-MORROS	"></option> 
<option value="	PFR-PASSAGEM FRANCA	"></option> 
<option value="	BHM-BARREIRAS MAGAZINE	"></option> 
<option value="	PET-PETROLINA	"></option> 
<option value="	PDC-PETROLINA DEPOSITO FECHADO	"></option> 
<option value="	FLO-FLORIANO	"></option> 
<option value="	MEM-MANOEL EMIDIO	"></option> 
<option value="	DPI-DEPOSITO DE PINHEIRO	"></option> 
<option value="	CLT-COLINAS DO TOCANTINS	"></option> 
<option value="	TUD-TUTÓIA	"></option> 
<option value="	DCO-DEPOSITO COLINAS	"></option> 
<option value="	CTL-CRISTALÂNDIA DO PIAUÍ	"></option> 
<option value="	BCA-BACABEIRA	"></option> 
<option value="	SHE-SANTA HELENA	"></option> 
<option value="	GUM-BOA VISTA DO GURUPÍ	"></option> 
<option value="	CRI-CRISTÓPOLIS	"></option> 
<option value="	MRA-MATA ROMA	"></option> 
<option value="	SJC-SÃO JOAO DO CARU	"></option> 
<option value="	PIX-PIO IX	"></option> 
<option value="	PBO-PASTOS BONS	"></option> 
<option value="	APA-APICUM-AÇU	"></option> 
<option value="	SER-SERRANO DO MARANHÃO	"></option> 
<option value="	MIZ-MIRINZAL	"></option> 
<option value="	CED-CEDRAL	"></option> 
<option value="	POM-PORTO RICO DO MARANHÃO	"></option> 
<option value="	PAU-PAULISTANA	"></option> 
<option value="	GUI-GUIMARÃES	"></option> 
<option value="	BEQ-BEQUIMÃO	"></option> 
<option value="	CME-CÂNDIDO MENDES	"></option> 
<option value="	CEN-CENTRAL DO MARANHÃO	"></option> 
<option value="	TRF-TRES FUROS	"></option> 
<option value="	PSA-PRESIDENTE SARNEY	"></option> 
<option value="	BCB-BACURITUBA	"></option> 
<option value="	SJB-SÃO JOÃO BATISTA	"></option> 
<option value="	ALC-ALCÂNTARA	"></option> 
<option value="	SVF-SÃO VICENTE DE FERRER	"></option> 
<option value="	PME-PALMEIRANDIA	"></option> 
<option value="	PAS-PARAISO	"></option> 
<option value="	BRE-BREJO	"></option> 
<option value="	TUR-TURIAÇÚ	"></option> 
<option value="	LDO-LUÍS DOMINGUES	"></option> 
<option value="	PDA-ASSISTENCIA PEDREIRAS	"></option> 
<option value="	IPM-IGARAPÉ DO MEIO	"></option> 
<option value="	PTO-PARAÍSO DO TOCANTINS	"></option> 
<option value="	ITI-ITAINÓPOLIS	"></option> 
<option value="	JAI-JAICÓS	"></option> 
<option value="	CDF-CODO MERCADO	"></option> 
<option value="	ARP-ARARIPINA	"></option> 
<option value="	SJA-SÃO JOÃO DO ARRAIAL	"></option> 
<option value="	BDC-BODOCÓ	"></option> 
<option value="	BUB-BURITÍ BRAVO	"></option> 
<option value="	TOC-TOCANTINÓPOLIS	"></option> 
<option value="	DZE-DEPOSITO DE ZE DOCA	"></option> 
<option value="	ENC-ENCRUZO (GOV.NUNES FREIRE)	"></option> 
<option value="	SLP-SANTA LUZIA DO PARUÁ	"></option> 
<option value="	PLA-PILÃO ARCADO	"></option> 
<option value="	SNA-SANTANA DO SOBRADO	"></option> 
<option value="	PMI-PINDARE-MIRIM	"></option> 
<option value="	SFI-SANTA FILOMENA	"></option> 
<option value="	LOJAO-TERESINA	"></option> 
<option value="	ARD-ARARIPINA	"></option> 
<option value="	BJT-BOM JESUS DO TOCANTIMS	"></option> 
<option value="	ANJ-ANAJATUBA	"></option> 
<option value="	BFP-BOMFIM DO PIAUI	"></option> 
<option value="	SMV-SANTA MARIA DA VITORIA	"></option> 
<option value="	SDE-SÃO DESIDÉRIO	"></option> 
<option value="	BBV-BACABAL BELA VISTA	"></option> 


    </datalist>

    <label for="ocorrencia">Tipo de Ocorrência:</label>
    <select id="ocorrencia" required>
      <option value="" disabled selected>Selecione a ocorrência</option>
      <option value="">-- Selecione --</option>
 <option value="Alarme Disparado ">Alarme Disparado</option>
  <option value="intrusao">Intrusão / Invasão</option>
<option value="Perda de Sinal/ Comunicação">Perda de Sinal/ Comunicação</option>
<option value="Abertura/Fechamento fora de horário ">Abertura/Fechamento fora de horário</option>
      <option value="Queda de Conexão IP">Queda de Conexão IP</option>

    </select>

    <label for="status">Status:</label>
    <select id="status" required>
      <option value="" disabled selected>Selecione o status</option>
      <option>Com alteração</option>
      <option>Sem alteração</option>
    </select>

    <label for="obs">Observações (opcional):</label>
    <input type="text" id="obs" placeholder="Alguma informação extra..." autocomplete="off" />

    <button type="submit">Gerar Protocolo</button>
  </form>

  <div id="protocolos">
    <h2>Protocolos Registrados</h2>
    <input type="text" id="search" placeholder="Buscar protocolo..." autocomplete="off" />
    <div style="margin-bottom: 15px;">
      <button onclick="exportarCSV()" title="Exportar todos protocolos em CSV"><i class="fas fa-file-csv"></i> Exportar CSV</button>
      <button onclick="limparProtocolos()" title="Apagar todos os protocolos"><i class="fas fa-trash-alt"></i> Limpar Todos</button>
    </div>
    <div id="lista"></div>
  </div>

  <script>
    const form = document.getElementById('form');
    const lista = document.getElementById('lista');
    const search = document.getElementById('search');

    form.addEventListener('submit', (event) => {
      event.preventDefault();

      const loja = document.getElementById('lojaBusca').value.trim();
      const ocorrencia = document.getElementById('ocorrencia').value;
      const status = document.getElementById('status').value;
      const obs = document.getElementById('obs').value.trim();
      const dataHora = new Date().toLocaleString();
      const protocolo = gerarProtocolo();

      const registro = {
        remetente: "Central de Operação",
        dataHora,
        local: loja,
        tipoOcorrencia: ocorrencia,
        status,
        protocolo,
        obs
      };

      salvarProtocolo(registro);
      atualizarDatalist(loja);
      exibirProtocolos();
      form.reset();
    });

    function gerarProtocolo() {
      return Math.floor(100000 + Math.random() * 900000).toString();
    }

    function salvarProtocolo(registro) {
      const protocolos = JSON.parse(localStorage.getItem('protocolos') || '[]');
      protocolos.push(registro);
      localStorage.setItem('protocolos', JSON.stringify(protocolos));
    }

    function exibirProtocolos() {
      const protocolos = JSON.parse(localStorage.getItem('protocolos') || '[]');
      protocolos.sort((a, b) => new Date(b.dataHora) - new Date(a.dataHora));
      lista.innerHTML = '';

      protocolos.forEach(item => {
        const div = document.createElement('div');
        div.className = 'protocolo ' + (item.status === 'Com alteração' ? 'com-alteracao' : 'sem-alteracao');
        div.innerText =
          `Remetente: ${item.remetente}\n` +
          `Data/Hora: ${item.dataHora}\n` +
          `Local Monitorado: ${item.local}\n` +
          `Tipo de Ocorrência: ${item.tipoOcorrencia}\n` +
          `Status: ${item.status}\n` +
          `Número de Protocolo: ${item.protocolo}\n` +
          `Observações: ${item.obs || 'N/A'}`;

        // Botão WhatsApp
        const btnWhats = document.createElement('button');
        btnWhats.className = 'whatsapp';
        btnWhats.title = 'Enviar via WhatsApp';
        btnWhats.innerHTML = '<i class="fab fa-whatsapp"></i>';
        btnWhats.onclick = () => {
          const mensagem =
            `*Central de Operação*\n` +
            `Remetente: ${item.remetente}\n` +
            `Data/Hora: ${item.dataHora}\n` +
            `Local Monitorado: ${item.local}\n` +
            `Tipo de Ocorrência: ${item.tipoOcorrencia}\n` +
            `Status: ${item.status}\n` +
            `Número de Protocolo: ${item.protocolo}\n` +
            `Observações: ${item.obs || 'N/A'}`;
          const textoURL = encodeURIComponent(mensagem);

          // Abre app WhatsApp no celular
          const url = `whatsapp://send?text=${textoURL}`;
          window.location.href = url;
        };
        div.appendChild(btnWhats);

        // Botão Excluir
        const btnExcluir = document.createElement('button');
        btnExcluir.className = 'excluir';
        btnExcluir.title = 'Excluir protocolo';
        btnExcluir.innerHTML = '<i class="fas fa-trash-alt"></i>';
        btnExcluir.onclick = () => {
          deletarProtocolo(item.protocolo);
        };
        div.appendChild(btnExcluir);

        lista.appendChild(div);
      });
    }

    function deletarProtocolo(numero) {
      let protocolos = JSON.parse(localStorage.getItem('protocolos') || '[]');
      protocolos = protocolos.filter(p => p.protocolo !== numero);
      localStorage.setItem('protocolos', JSON.stringify(protocolos));
      exibirProtocolos();
    }

    function limparProtocolos() {
      if (confirm('Deseja realmente apagar todos os protocolos?')) {
        localStorage.removeItem('protocolos');
        exibirProtocolos();
      }
    }

    function exportarCSV() {
      const protocolos = JSON.parse(localStorage.getItem('protocolos') || '[]');
      if (protocolos.length === 0) {
        alert('Nenhum protocolo para exportar.');
        return;
      }
      const cabecalho = ['Remetente','Data/Hora','Local Monitorado','Tipo de Ocorrência','Status','Número de Protocolo','Observações'];
      const linhas = protocolos.map(p => [
        p.remetente,
        `"${p.dataHora}"`,
        p.local,
        p.tipoOcorrencia,
        p.status,
        p.protocolo,
        `"${p.obs || ''}"`
      ].join(';'));
      const csvContent = [cabecalho.join(';'), ...linhas].join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', 'protocolos.csv');
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function atualizarDatalist(loja) {
      const datalist = document.getElementById('lojas');
      const options = Array.from(datalist.options).map(opt => opt.value);
      if (!options.includes(loja)) {
        const option = document.createElement('option');
        option.value = loja;
        datalist.appendChild(option);
      }
    }

    search.addEventListener('input', () => {
      const termo = search.value.trim().toLowerCase();
      const protocolos = document.querySelectorAll('.protocolo');
      protocolos.forEach(div => {
        const contem = div.innerText.toLowerCase().includes(termo);
        div.style.display = contem ? 'block' : 'none';
        div.classList.toggle('highlight', contem);
      });
    });

    // Inicializa lista na carga
    exibirProtocolos();
  </script>
</body>
</html>
